import{d as e,H as l,u as a,I as s,r as t,J as o,B as r,o as u,O as d,c,a as i,b as n,P as p,Q as m,e as x,f as _,v as f,g,j as h,k as w,h as b,m as v,n as y,l as V,F as j,L as k,M as z,N as I,s as U}from"./index-CbP45Wwt.js";import{_ as C}from"./index.vue_vue_type_script_setup_true_lang.E7x_lWMO.js";import{_ as E}from"./wd-input.BHaKXBII.js";import{_ as N,N as T}from"./notice.4Vk_mI8L.js";import{_ as L}from"./wd-button.VA8QVjvr.js";import{_ as A}from"./wd-form.vue_vue_type_script_setup_true_lang.DscUGWD7.js";import"./types.DuL_ynPZ.js";import"./index.CDE1r9Ff.js";import"./index.D9GroqTO.js";import{_ as B}from"./close-channel.vue_vue_type_script_setup_true_lang.xCxJBb7L.js";import{_ as F}from"./auth-protocol.vue_vue_type_script_setup_true_lang.DCutcNGz.js";import"./useTranslate.BahM4N0k.js";import"./wd-checkbox.4avEtivn.js";const H=U(e({__name:"register",setup(e){const U=l(),H=a(),M=s(),O=t(!1),P=t(!0),R=t(!1),W=t(!1),X=o({account:"",password:"",confirm_pwd:"",mobile:"",code:""}),G=r(()=>{var e,l,a,s,t,o,r,u,d;const c=H.getLoginConfig;switch(p.fetchClient()){case m.H5:return P.value=null==(e=c.h5)?void 0:e.is_agreement,O.value=!(null==(a=null==(l=c.h5)?void 0:l.usable_register)?void 0:a.includes("account")),c.h5||{};case m.MP_WEIXIN:case m.OA_WEIXIN:return P.value=null==(s=c.wx)?void 0:s.is_agreement,O.value=!(null==(o=null==(t=c.wx)?void 0:t.usable_register)?void 0:o.includes("account")),c.wx||{};default:return P.value=null==(r=c.other)?void 0:r.is_agreement,O.value=!(null==(d=null==(u=c.other)?void 0:u.usable_register)?void 0:d.includes("account")),c.other||{}}}),J=async()=>{if(X.code)return U.show("请输入登录账号"),!1;if(!X.password)return U.show("请输入登录密码"),!1;if(X.password!==X.confirm_pwd)return U.show("两次输入密码不一致"),!1;if(P.value&&!R.value)return U.show("请阅读《服务协议》与《隐私协议》"),!1;if(G.value.force_mobile){if(!X.mobile)return U.show("请填写手机号码"),!1;if(!X.mobile)return U.show("请填写验证码"),!1}W.value=!0,await I.register({account:X.account,password:X.password,mobile:X.mobile,code:X.code}).then(async e=>{U.show("注册成功"),await M.login(e.token),setTimeout(()=>{d({url:"/pages/user/index"}),W.value=!1},1e3)}).finally(()=>{setTimeout(()=>{W.value=!1},1500)})};return u(()=>{M.isLogin&&d({url:"/pages/index/index"})}),(e,l)=>{const a=w,s=x(_("w-widget-bar"),C),t=x(_("wd-icon"),f),o=x(_("wd-input"),E),r=x(_("w-verify-code"),N),u=x(_("wd-button"),L),d=z,p=x(_("wd-form"),A),m=n("global-ku-root");return g(),c(m,null,{default:i(()=>[h(O)?(g(),c(a,{key:0,class:"flex-1 flex items-center justify-center"},{default:i(()=>[b(B,{message:"注册渠道尚未开放"})]),_:1})):(g(),c(a,{key:1,class:"register flex-1 flex flex-col bg-page"},{default:i(()=>[b(s),b(a,{class:"text-6xl text-tx-primary font-bold px-10 mt-10"},{default:i(()=>[v(" 注册账号 ")]),_:1}),b(a,{class:"text-sm text-tx-placeholder px-10 mt-2"},{default:i(()=>[v(" 别看了，就差你了！快注册！ ")]),_:1}),b(a,{class:"w-full px-10 mt-10"},{default:i(()=>[b(p,{ref:"form",model:h(X)},{default:i(()=>[b(a,{class:"flex items-center py-1.5 px-4 rounded-[60rpx] bg-lighter"},{default:i(()=>[b(t,{name:"user",size:"38rpx"}),b(a,{class:"w-[1px] h-[40rpx] mx-2.5 bg-light"}),b(o,{modelValue:h(X).account,"onUpdate:modelValue":l[0]||(l[0]=e=>h(X).account=e),maxlength:20,prop:"account",clearable:"","clear-trigger":"focus",placeholder:"请输入账号","placeholder-class":"!text-tx-placeholder"},null,8,["modelValue"])]),_:1}),b(a,{class:"flex items-center py-1.5 px-4 mt-4 rounded-[60rpx] bg-lighter"},{default:i(()=>[b(t,{name:"lock-on",size:"38rpx"}),b(a,{class:"w-[1px] h-[40rpx] mx-2.5 bg-light"}),b(o,{modelValue:h(X).password,"onUpdate:modelValue":l[1]||(l[1]=e=>h(X).password=e),maxlength:50,prop:"password",clearable:"","show-password":"","clear-trigger":"focus",placeholder:"请输入密码","placeholder-class":"!text-tx-placeholder"},null,8,["modelValue"])]),_:1}),b(a,{class:"flex items-center py-1.5 px-4 mt-4 rounded-[60rpx] bg-lighter"},{default:i(()=>[b(t,{name:"lock-on",size:"38rpx"}),b(a,{class:"w-[1px] h-[40rpx] mx-2.5 bg-light"}),b(o,{modelValue:h(X).confirm_pwd,"onUpdate:modelValue":l[2]||(l[2]=e=>h(X).confirm_pwd=e),maxlength:50,prop:"password",clearable:"","show-password":"","clear-trigger":"focus",placeholder:"请确认密码","placeholder-class":"!text-tx-placeholder"},null,8,["modelValue"])]),_:1}),h(G).force_mobile?(g(),y(j,{key:0},[b(a,{class:"flex items-center py-1.5 px-4 mt-4 rounded-[60rpx] bg-lighter"},{default:i(()=>[b(t,{name:"mobile",size:"38rpx"}),b(a,{class:"w-[1px] h-[40rpx] mx-2.5 bg-light"}),b(o,{modelValue:h(X).mobile,"onUpdate:modelValue":l[3]||(l[3]=e=>h(X).mobile=e),maxlength:11,prop:"mobile",clearable:"","clear-trigger":"focus",placeholder:"请输入手机号","placeholder-class":"!text-tx-placeholder"},null,8,["modelValue"])]),_:1}),b(a,{class:"flex items-center py-1.5 px-4 mt-4 rounded-[60rpx] bg-lighter"},{default:i(()=>[b(t,{name:"secured",size:"38rpx"}),b(a,{class:"w-[1px] h-[40rpx] mx-2.5 bg-light"}),b(o,{modelValue:h(X).code,"onUpdate:modelValue":l[4]||(l[4]=e=>h(X).code=e),maxlength:15,prop:"code",type:"number",placeholder:"请输入验证码","placeholder-class":"!text-tx-placeholder"},null,8,["modelValue"]),b(r,{type:"mobile",mobile:h(X).mobile,scene:h(T).REGISTER},null,8,["mobile","scene"])]),_:1})],64)):V("",!0),h(G).is_agreement?(g(),c(a,{key:1,class:"mt-4 ml-2"},{default:i(()=>[b(F,{modelValue:h(R),"onUpdate:modelValue":l[5]||(l[5]=e=>k(R)?R.value=e:null)},null,8,["modelValue"])]),_:1})):V("",!0),b(a,{class:"mt-6"},{default:i(()=>[b(u,{type:"primary",size:"large",disabled:h(W),loading:h(W),block:"",onClick:J},{default:i(()=>[v(" 注册 ")]),_:1},8,["disabled","loading"])]),_:1}),b(a,{class:"text-center text-sm mt-4"},{default:i(()=>[b(d,{class:"text-tx-placeholder"},{default:i(()=>[v("已有账号?")]),_:1}),b(d,{class:"ml-1 text-primary",onClick:l[6]||(l[6]=l=>e.$go("/pages/login/index"))},{default:i(()=>[v(" 立即登录 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}))]),_:1})}}}),[["__scopeId","data-v-92dcdaad"]]);export{H as default};
