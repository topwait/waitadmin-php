import{d as e,H as a,r as l,J as s,w as o,c as r,a as t,b as d,e as i,f as n,v as u,g as m,h as p,k as c,l as b,j as f,G as w,m as x,t as _,U as g,b0 as h,s as v}from"./index-CbP45Wwt.js";import{_ as y}from"./wd-input.BHaKXBII.js";import{_ as j}from"./wd-button.VA8QVjvr.js";import{_ as k}from"./wd-form.vue_vue_type_script_setup_true_lang.DscUGWD7.js";import{_ as V,N as z}from"./notice.4Vk_mI8L.js";import"./types.DuL_ynPZ.js";import"./index.CDE1r9Ff.js";import"./index.D9GroqTO.js";import{v as B}from"./validate.Dts8u5Zl.js";import"./useTranslate.BahM4N0k.js";const E=v(e({__name:"adjust_email",setup(e){const v=a(),E=l(!1),U=s({password:"",email:"",code:""}),C=l(1),F=l(!1),I=l(!1),T=l(!1),A=l(""),M=async()=>{E.value=!0,await g.checkPwd(U.password).then(()=>{C.value=2}).catch(()=>{}).finally(()=>{setTimeout(()=>{E.value=!1},1e3)})},N=async()=>U.email?B.isEmail(U.email)?U.code?(E.value=!0,void(await g.bindEmail({password:U.password,email:U.email,code:U.code}).then(()=>{v.show("修改成功"),h()}).catch(()=>{}).finally(()=>{setTimeout(()=>{E.value=!1},800)}))):(v.show("请输入验证码"),!1):(v.show("电子邮箱无效"),!1):(v.show("请填写邮箱号"),!1);return o(()=>U.password,e=>{e?e.length<6||e.length>20?A.value="密码长度不合法":A.value="":A.value="密码不能为空"}),(e,a)=>{const l=i(n("wd-input"),y),s=c,o=i(n("wd-button"),j),g=i(n("wd-form"),k),h=i(n("wd-icon"),u),v=i(n("w-verify-code"),V),B=d("global-ku-root");return m(),r(B,null,{default:t(()=>[p(s,{class:"flex-1 p-6 pt-10 border-t border-br-thinned bg-page"},{default:t(()=>[1===f(C)?(m(),r(g,{key:0,model:f(U),class:"w-full"},{default:t(()=>[p(s,{class:w(["flex items-center p-3.5 rounded-xl bg-lighter border-2",f(A)?"border-danger":f(F)?"border-primary":"border-transparent"])},{default:t(()=>[p(l,{modelValue:f(U).password,"onUpdate:modelValue":a[0]||(a[0]=e=>f(U).password=e),disabled:f(E),"no-border":!0,prop:"password","show-password":"",placeholder:"请输入登录密码","custom-class":"flex-1 !bg-transparent",onFocus:a[1]||(a[1]=e=>F.value=!0),onBlur:a[2]||(a[2]=e=>F.value=!1)},null,8,["modelValue","disabled"])]),_:1},8,["class"]),p(s,{class:"pt-2 pl-3 text-sm text-danger h-4.5"},{default:t(()=>[f(A)?(m(),r(s,{key:0},{default:t(()=>[x(_(f(A)),1)]),_:1})):b("",!0)]),_:1}),p(s,{class:"mt-8 px-2 text-sm text-tx-placeholder"},{default:t(()=>[x(" 为了确保您是账户拥有者，现需要对您进行登录密码安全检验， 验证通过后方可进行修改。 ")]),_:1}),p(s,{class:"mt-6"},{default:t(()=>[p(o,{type:"primary",size:"large",block:!0,loading:f(E),disabled:f(E)||!f(U).password,onClick:M},{default:t(()=>[x(" 开始校验 ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"])):b("",!0),2===f(C)?(m(),r(g,{key:1,model:f(U),class:"w-full"},{default:t(()=>[p(s,{class:w(["flex items-center p-3.5 rounded-xl bg-lighter border-2",f(T)?"border-primary":"border-transparent"])},{default:t(()=>[p(h,{name:"mail",size:"38rpx",class:"text-tx-placeholder"}),p(s,{class:"w-[1px] h-[40rpx] mx-2.5 bg-light"}),p(l,{modelValue:f(U).email,"onUpdate:modelValue":a[3]||(a[3]=e=>f(U).email=e),disabled:f(E),"no-border":!0,prop:"mobile",type:"text",placeholder:"请输邮箱号","custom-class":"!bg-transparent",onFocus:a[4]||(a[4]=e=>T.value=!0),onBlur:a[5]||(a[5]=e=>T.value=!1)},null,8,["modelValue","disabled"])]),_:1},8,["class"]),p(s,{class:w(["flex items-center p-3.5 mt-4 rounded-xl bg-lighter border-2",f(I)?"border-primary":"border-transparent"])},{default:t(()=>[p(l,{modelValue:f(U).code,"onUpdate:modelValue":a[6]||(a[6]=e=>f(U).code=e),"no-border":!0,prop:"code",type:"number",placeholder:"请输入验证码","custom-class":"flex-1 !bg-transparent",onFocus:a[7]||(a[7]=e=>I.value=!0),onBlur:a[8]||(a[8]=e=>I.value=!1)},null,8,["modelValue"]),p(s,{class:"w-[1px] h-[40rpx] mx-2.5 bg-light"}),p(v,{type:"email",email:f(U).email,scene:f(z).BIND_EMAIL},null,8,["email","scene"])]),_:1},8,["class"]),p(s,{class:"mt-8"},{default:t(()=>[p(o,{type:"primary",size:"large",block:!0,loading:f(E),disabled:f(E)||!f(U).email||!f(U).code,onClick:N},{default:t(()=>[x(" 确认修改 ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"])):b("",!0)]),_:1})]),_:1})}}}),[["__scopeId","data-v-836042f1"]]);export{E as default};
