import{y as e,bf as l,v as a,x as t,W as o,bh as n,bi as s,$ as u,d as i,r,w as c,Y as d,c as m,g as v,k as p,D as g,E as f,a as h,l as y,h as b,Q as k,bj as _,n as w,p as C,bk as x,F as V,m as K,t as S,bl as $,ap as I,bm as F,bn as T,a5 as z,q as H,A as P,ag as E,an as j,bo as A,j as D,bp as O,s as B,ay as q,C as L,be as R}from"./index-4glTkX_N.js";import{w as W}from"./wd-popup.DsWtaoA5.js";import{_ as G}from"./wd-cell-group.DNEkijk0.js";import{u as N}from"./useTranslate.By_X5Fzm.js";function M(e,l,a){let t=n(e)?e:[e];const o=new Set(e.map(s));if(1!==o.size&&o.has("object"))throw Error("The columns are correct");n(e[0])||(t=[t]);return t.map(e=>e.map(e=>{if(!u(e))return{[l]:e,[a]:e};if(!e.hasOwnProperty(l)&&!e.hasOwnProperty(a))throw Error("Can't find valueKey and labelKey in columns");return e.hasOwnProperty(a)||(e[a]=e[l]),e.hasOwnProperty(l)||(e[l]=e[a]),e}))}const U=H(i({name:"wd-picker-view",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...e,loading:a(!1),loadingColor:t("#4D80F0"),columnsHeight:o(217),itemHeight:o(35),valueKey:t("value"),labelKey:t("label"),immediateChange:a(!1),modelValue:{type:[String,Number,Boolean,Array,Array,Array],default:"",required:!0},columns:l(),columnChange:Function},emits:["change","pickstart","pickend","update:modelValue"],setup(e,{expose:l,emit:a}){const t=e,o=a,u=r([]),i=r([]);c([()=>t.modelValue,()=>t.columns],(e,l)=>{T(l[1],e[1])||(n(e[1])&&e[1].length>0?u.value=M(e[1],t.valueKey,t.labelKey):(u.value=[],i.value=[])),z(e[0])&&function(e){if(0===u.value.length)return void(i.value=[]);(""===e||!z(e)||n(e)&&0===e.length)&&(e=u.value.map(e=>e[0][t.valueKey]));const l=s(e),a=["string","number","boolean","array"];-1===a.indexOf(l)&&console.error(`value must be one of ${a.toString()}`);e=(e=n(e)?e:[e]).slice(0,u.value.length);let o=$(i.value);e.forEach((e,l)=>{let a=u.value[l].findIndex(l=>l[t.valueKey].toString()===e.toString());a=-1===a?0:a,o=P(l,a,o)}),i.value=o.slice(0,e.length)}(e[0])},{deep:!0,immediate:!0});const{proxy:H}=d();function P(e,l,a){const t=u.value[e];if(!t||!t[l])throw Error(`The value to select with Col:${e} Row:${l} is incorrect`);const o=$(a);if(o[e]=l,t[l].disabled){const a=t.slice(0,l).reverse().findIndex(e=>!e.disabled),n=t.slice(l+1).findIndex(e=>!e.disabled);-1!==a?o[e]=l-1-a:-1!==n?o[e]=l+1+n:void 0===o[e]&&(o[e]=0)}return o}function E({detail:{value:e}}){const l=function(e){e=e.slice(0,u.value.length);const l=$(i.value);let a=$(i.value);e.forEach((e,t)=>{(e=F(e,0,u.value[t].length-1))!==l[t]&&(a=P(t,e,a))});const t=function(e,l){if(!e||!l)return-1;const a=e.findIndex((e,a)=>e!==l[a]);return a}(a,l);if(-1===t)return;const o=a[t];return 1===a.length?o:t}(e=e.map(e=>Number(e||0)));i.value=$(e),I(()=>{i.value=function(e){let l=$(e);return e.forEach((e,a)=>{e=F(e,0,u.value[a].length-1),l=P(a,e,l)}),l}(e),t.columnChange?t.columnChange.length<4?(t.columnChange(H.$.exposed,A(),l||0,()=>{}),j(l||0)):t.columnChange(H.$.exposed,A(),l||0,()=>{j(l||0)}):j(l||0)})}function j(e){const l=D();T(l,t.modelValue)||(o("update:modelValue",l),setTimeout(()=>{o("change",{picker:H.$.exposed,value:l,index:e})},0))}function A(){const e=i.value.map((e,l)=>u.value[l][e]);return 1===e.length?e[0]:e}function D(){const{valueKey:e}=t,l=i.value.map((l,a)=>u.value[a][l][e]);return 1===l.length?l[0]:l}function O(){o("pickstart")}function B(){o("pickend")}return l({getSelects:A,getValues:D,setColumnData:function(e,l,a=0){u.value[e]=M(l,t.valueKey,t.labelKey).reduce((e,l)=>e.concat(l),[]),i.value=P(e,a,i.value)},getColumnsData:function(){return $(u.value)},getColumnData:function(e){return u.value[e]},getColumnIndex:function(e){return i.value[e]},getLabels:function(){const{labelKey:e}=t;return i.value.map((l,a)=>u.value[a][l][e])},getSelectedIndex:function(){return i.value},resetColumns:function(e){n(e)&&e.length&&(u.value=M(e,t.valueKey,t.labelKey))}}),(e,l)=>{const a=p,t=x,o=_;return v(),m(a,{class:f(`wd-picker-view ${e.customClass}`),style:g(e.customStyle)},{default:h(()=>[e.loading?(v(),m(a,{key:0,class:"wd-picker-view__loading"},{default:h(()=>[b(k,{color:e.loadingColor},null,8,["color"])]),_:1})):y("",!0),b(a,{style:g(`height: ${e.columnsHeight-20}px;`)},{default:h(()=>[b(o,{"mask-class":"wd-picker-view__mask","indicator-class":"wd-picker-view__roller","indicator-style":`height: ${e.itemHeight}px;`,style:g(`height: ${e.columnsHeight-20}px;`),value:i.value,"immediate-change":e.immediateChange,onChange:E,onPickstart:O,onPickend:B},{default:h(()=>[(v(!0),w(V,null,C(u.value,(l,o)=>(v(),m(t,{key:o,class:"wd-picker-view-column"},{default:h(()=>[(v(!0),w(V,null,C(l,(l,t)=>(v(),m(a,{key:t,class:f(`wd-picker-view-column__item ${l.disabled?"wd-picker-view-column__item--disabled":""}  ${i.value[o]==t?"wd-picker-view-column__item--active":""}`),style:g(`line-height: ${e.itemHeight}px;`)},{default:h(()=>[K(S(l[e.labelKey]),1)]),_:2},1032,["class","style"]))),128))]),_:2},1024))),128))]),_:1},8,["indicator-style","style","value","immediate-change"])]),_:1},8,["style"])]),_:1},8,["class","style"])}}}),[["__scopeId","data-v-cdad4f27"]]),Q=H(i({name:"wd-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...e,customLabelClass:t(""),customValueClass:t(""),customViewClass:t(""),label:String,placeholder:String,disabled:a(!1),readonly:a(!1),loading:a(!1),loadingColor:t("#4D80F0"),title:String,cancelButtonText:String,confirmButtonText:String,required:a(!1),size:String,labelWidth:t("33%"),useDefaultSlot:a(!1),useLabelSlot:a(!1),error:a(!1),alignRight:a(!1),beforeConfirm:Function,closeOnClickModal:a(!0),safeAreaInsetBottom:a(!0),ellipsis:a(!1),columnsHeight:o(217),valueKey:t("value"),labelKey:t("label"),modelValue:{type:[String,Number,Array],default:""},columns:{type:Array,default:()=>[]},columnChange:Function,displayFormat:Function,zIndex:o(15),prop:String,rules:l(),immediateChange:a(!1),rootPortal:a(!1),clearable:a(!1),markerSide:t("before")},emits:["confirm","open","cancel","clear","update:modelValue"],setup(e,{expose:l,emit:a}){const{translate:t}=N("picker"),o=e,u=a,i=r(null),k=r(!1),_=r(!1),w=r(""),C=r(""),x=r([]),V=r([]),F=r(!1),T=r(!1),H=P(()=>o.loading||k.value);c(()=>o.displayFormat,e=>{e&&!R(e)&&console.error("The type of displayFormat must be Function"),i.value&&0!==i.value.getSelectedIndex().length&&Z(o.modelValue)},{immediate:!0,deep:!0}),c(()=>o.modelValue,e=>{C.value=e,Z(e)},{deep:!0,immediate:!0}),c(()=>o.columns,e=>{x.value=$(e),V.value=$(e),0===e.length?(C.value=n(o.modelValue)?[]:"",w.value=""):Z(o.modelValue)},{deep:!0,immediate:!0}),c(()=>o.columnChange,e=>{e&&!R(e)&&console.error("The type of columnChange must be Function")},{deep:!0,immediate:!0});const Q=P(()=>o.clearable&&!o.disabled&&!o.readonly&&w.value.length>0),Y=P(()=>!o.disabled&&!o.readonly&&!Q.value),J=P(()=>{const e=["wd-picker__cell"];return o.disabled&&e.push("is-disabled"),o.readonly&&e.push("is-readonly"),o.error&&e.push("is-error"),w.value||e.push("wd-picker__cell--placeholder"),e.join(" ")}),{proxy:X}=d();function Z(e){n(e)&&e.length>0||z(e)&&!n(e)&&""!==e?i.value?I(()=>{ne(i.value.getSelects())}):ne(function(e){const l=M(o.columns,o.valueKey,o.labelKey);if(0===o.columns.length)return;if(""===e||!z(e)||n(e)&&0===e.length)return;const a=s(e);if(-1===["string","number","boolean","array"].indexOf(a))return[];e=n(e)?e:[e],e=e.slice(0,l.length),0===e.length&&(e=l.map(()=>0));let t=[];e.forEach((e,a)=>{let n=l[a].findIndex(l=>l[o.valueKey].toString()===e.toString());n=-1===n?0:n,t.push(n)});const u=t.map((e,a)=>l[a][e]);if(1===u.length)return u[0];return u}(e)):w.value=""}function ee(){o.disabled||o.readonly||(u("open"),_.value=!0,C.value=o.modelValue,x.value=V.value)}function le(){_.value=!1,u("cancel");let e=setTimeout(()=>{clearTimeout(e),z(i.value)&&i.value.resetColumns(V.value)},300)}function ae(){if(H.value)return;if(F.value)return void(T.value=!0);const{beforeConfirm:e}=o;e&&R(e)?e(C.value,e=>{e&&te()},X.$.exposed):te()}function te(){if(H.value||o.disabled)return void(_.value=!1);const e=i.value.getSelects(),l=i.value.getValues(),a=i.value.getColumnsData();_.value=!1,V.value=$(a),u("update:modelValue",l),ne(e),u("confirm",{value:l,selectedItems:e})}function oe({value:e}){C.value=e}function ne(e){if(n(e)&&!e.length||!e)return;const{valueKey:l,labelKey:a}=o;w.value=(o.displayFormat||A)(e,{valueKey:l,labelKey:a})}function se(){}function ue(){F.value=!0}function ie(){F.value=!1,T.value&&(T.value=!1,ae())}function re(){const e=n(C.value)?[]:"";u("update:modelValue",e),u("clear")}return E(()=>{Z(o.modelValue)}),j(()=>{x.value=$(o.columns),V.value=$(o.columns)}),l({close:function(){le()},open:function(){ee()},setLoading:function(e){k.value=e}}),(e,l)=>{const a=p;return v(),m(a,{class:f(`wd-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`),style:g(e.customStyle)},{default:h(()=>[e.$slots.default?(v(),m(a,{key:1,onClick:ee},{default:h(()=>[L(e.$slots,"default",{},void 0,!0)]),_:3})):(v(),m(G,{key:0,title:e.label,value:w.value?w.value:e.placeholder||D(t)("placeholder"),required:e.required,size:e.size,"title-width":e.labelWidth,prop:e.prop,rules:e.rules,clickable:!e.disabled&&!e.readonly,"value-align":e.alignRight?"right":"left","custom-class":J.value,"custom-style":e.customStyle,"custom-title-class":e.customLabelClass,"custom-value-class":e.customValueClass,ellipsis:e.ellipsis,"use-title-slot":!!e.$slots.label,"marker-side":e.markerSide,onClick:ee},O({"right-icon":h(()=>[Y.value?(v(),m(B,{key:0,"custom-class":"wd-picker__arrow",name:"arrow-right"})):Q.value?(v(),m(a,{key:1,onClick:q(re,["stop"])},{default:h(()=>[b(B,{"custom-class":"wd-picker__clear",name:"error-fill"})]),_:1})):y("",!0)]),_:2},[e.$slots.label?{name:"title",fn:h(()=>[L(e.$slots,"label",{},void 0,!0)]),key:"0"}:void 0]),1032,["title","value","required","size","title-width","prop","rules","clickable","value-align","custom-class","custom-style","custom-title-class","custom-value-class","ellipsis","use-title-slot","marker-side"])),b(W,{modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=e=>_.value=e),position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"z-index":e.zIndex,"safe-area-inset-bottom":e.safeAreaInsetBottom,"root-portal":e.rootPortal,onClose:le,"custom-class":"wd-picker__popup"},{default:h(()=>[b(a,{class:"wd-picker__wraper"},{default:h(()=>[b(a,{class:"wd-picker__toolbar",onTouchmove:se},{default:h(()=>[b(a,{class:"wd-picker__action wd-picker__action--cancel",onClick:le},{default:h(()=>[K(S(e.cancelButtonText||D(t)("cancel")),1)]),_:1}),e.title?(v(),m(a,{key:0,class:"wd-picker__title"},{default:h(()=>[K(S(e.title),1)]),_:1})):y("",!0),b(a,{class:f("wd-picker__action "+(H.value?"is-loading":"")),onClick:ae},{default:h(()=>[K(S(e.confirmButtonText||D(t)("done")),1)]),_:1},8,["class"])]),_:1}),b(U,{ref_key:"pickerViewWd",ref:i,"custom-class":e.customViewClass,modelValue:C.value,"onUpdate:modelValue":l[0]||(l[0]=e=>C.value=e),columns:x.value,loading:H.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,"immediate-change":e.immediateChange,onChange:oe,onPickstart:ue,onPickend:ie,"column-change":e.columnChange},null,8,["custom-class","modelValue","columns","loading","loading-color","columns-height","value-key","label-key","immediate-change","column-change"])]),_:1})]),_:1},8,["modelValue","close-on-click-modal","z-index","safe-area-inset-bottom","root-portal"])]),_:3},8,["class","style"])}}}),[["__scopeId","data-v-e8a8e208"]]);export{Q as _};
