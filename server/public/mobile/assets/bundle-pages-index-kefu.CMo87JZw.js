import{aT as e,aU as t,aP as a,aV as s,aF as i,N as n,aD as o,aW as l,d as c,u as r,r as u,A as d,c as m,a as h,b as p,e as f,f as w,_ as g,g as b,h as y,j as v,k as x,m as _,t as k,l as A}from"./index-4glTkX_N.js";import{_ as P}from"./index.BM_KXrMv.js";import{_ as I}from"./wd-button.Bm4eyLOH.js";const T={async saveToAlbum(e){if(e){await i({title:"保存中..."});try{n.isWeixin()?await this.saveInOaWeixin(e):await this.saveInH5(e),o(),await s({title:"保存成功",icon:"success"})}catch(t){o();const e=(null==t?void 0:t.errMsg)||(null==t?void 0:t.message)||"保存失败";e.includes("auth deny")||e.includes("authorize")?l({title:"提示",content:"需要您授权保存图片到相册",confirmText:"去设置",success:e=>{e.confirm&&uni.openSetting({})}}):await s({title:e,icon:"none"})}}else await s({title:"图片地址不能为空",icon:"none"})},async saveInMpWeixin(e){return new Promise((a,s)=>{const i=()=>{e.startsWith("http")?t({url:e,success:e=>{200===e.statusCode?this.saveImageToAlbum(e.tempFilePath).then(a).catch(s):s(new Error("下载图片失败"))},fail:s}):this.saveImageToAlbum(e).then(a).catch(s)};uni.getSetting({success:e=>{e.authSetting["scope.writePhotosAlbum"]?void 0===e.authSetting["scope.writePhotosAlbum"]?uni.authorize({scope:"scope.writePhotosAlbum",success:()=>i(),fail:s}):i():s({errMsg:"auth deny"})},fail:s})})},saveInOaWeixin:async e=>new Promise(t=>{a({urls:[e],current:e,success:()=>{s({title:"请长按图片保存",icon:"none",duration:2e3}),t()}})}),async saveInH5(e){return new Promise((t,a)=>{try{e.startsWith("http")?fetch(e).then(e=>e.blob()).then(e=>{const a=URL.createObjectURL(e);this.downloadByLink(a,"qrcode.png"),URL.revokeObjectURL(a),t()}).catch(()=>{window.open(e,"_blank"),t()}):(this.downloadByLink(e,"qrcode.png"),t())}catch(s){a(s)}})},downloadByLink(e,t){const a=document.createElement("a");a.href=e,a.download=t,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)},async saveInApp(e){return new Promise((a,s)=>{e.startsWith("http")?t({url:e,success:e=>{200===e.statusCode?this.saveImageToAlbum(e.tempFilePath).then(a).catch(s):s(new Error("下载图片失败"))},fail:s}):this.saveImageToAlbum(e).then(a).catch(s)})},saveImageToAlbum:t=>new Promise((a,s)=>{e({filePath:t,success:()=>a(),fail:s})})},W=c({__name:"kefu",setup(e){const t=r(),a=u(!1),i=d(()=>t.diyDto.tie),n=()=>{var e;(null==(e=i.value)?void 0:e.image)?T.saveToAlbum(i.value.image):s({title:"二维码图片不存在",icon:"none"})};return(e,t)=>{const s=f(w("w-loading"),P),o=f(w("wd-img"),g),l=x,c=f(w("wd-button"),I),r=p("global-ku-root");return b(),m(r,null,{default:h(()=>[y(s,{show:v(a)},null,8,["show"]),y(l,{class:"pt-8 mx-8"},{default:h(()=>[y(l,{class:"pt-7 h-[900rpx] rounded-xl bg-page"},{default:h(()=>[y(l,{class:"flex flex-col items-center"},{default:h(()=>[y(o,{width:"390rpx",height:"390rpx",src:v(i).image},null,8,["src"]),y(l,{class:"mt-3 text-xl font-bold"},{default:h(()=>[_(k(v(i).title),1)]),_:1}),y(l,{class:"mt-5 text-base text-tx-primary leading-7"},{default:h(()=>[v(i).datetime?(b(),m(l,{key:0},{default:h(()=>[_(" 服务时间："+k(v(i).datetime),1)]),_:1})):A("",!0),v(i).datetime?(b(),m(l,{key:1},{default:h(()=>[_(" 服务电话："+k(v(i).mobile),1)]),_:1})):A("",!0),v(i).datetime?(b(),m(l,{key:2},{default:h(()=>[_(" 服务Q Q："+k(v(i).qq),1)]),_:1})):A("",!0)]),_:1})]),_:1}),y(l,{class:"pt-5 px-7"},{default:h(()=>[y(c,{type:"primary",size:"large",block:"",onClick:n},{default:h(()=>[_(" 保存二维码 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}});export{W as default};
