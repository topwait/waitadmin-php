import{b2 as e,b3 as t,b1 as n,b4 as a,r as o,b5 as i,b6 as r,af as s,a6 as l,B as u,b7 as c,d as f,H as m,b8 as d,e as v,f as b,c as p,g as h,j as y,E as T,a as I,M,m as x,t as g,i as w}from"./index-CbP45Wwt.js";import{_ as E}from"./wd-button.VA8QVjvr.js";import"./types.DuL_ynPZ.js";import"./index.CDE1r9Ff.js";import"./index.D9GroqTO.js";var _=/\s/;var B=/^\s+/;function D(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&_.test(e.charAt(t)););return t}(e)+1).replace(B,""):e}var S=/^[-+]0x[0-9a-f]+$/i,N=/^0b[01]+$/i,k=/^0o[0-7]+$/i,G=parseInt;function O(a){if("number"==typeof a)return a;if(function(n){return"symbol"==typeof n||e(n)&&"[object Symbol]"==t(n)}(a))return NaN;if(n(a)){var o="function"==typeof a.valueOf?a.valueOf():a;a=n(o)?o+"":o}if("string"!=typeof a)return 0===a?a:+a;a=D(a);var i=N.test(a);return i||k.test(a)?G(a.slice(2),i?2:8):S.test(a)?NaN:+a}var R=function(){return a.Date.now()},j=Math.max,A=Math.min;function F(e,t,a){var o,i,r,s,l,u,c=0,f=!1,m=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function v(t){var n=o,a=i;return o=i=void 0,c=t,s=e.apply(a,n)}function b(e){var n=e-u;return void 0===u||n>=t||n<0||m&&e-c>=r}function p(){var e=R();if(b(e))return h(e);l=setTimeout(p,function(e){var n=t-(e-u);return m?A(n,r-(e-c)):n}(e))}function h(e){return l=void 0,d&&o?v(e):(o=i=void 0,s)}function y(){var e=R(),n=b(e);if(o=arguments,i=this,u=e,n){if(void 0===l)return function(e){return c=e,l=setTimeout(p,t),f?v(e):s}(u);if(m)return clearTimeout(l),l=setTimeout(p,t),v(u)}return void 0===l&&(l=setTimeout(p,t)),s}return t=O(t)||0,n(a)&&(f=!!a.leading,r=(m="maxWait"in a)?j(O(a.maxWait)||0,t):r,d="trailing"in a?!!a.trailing:d),y.cancel=function(){void 0!==l&&clearTimeout(l),c=0,o=u=i=l=void 0},y.flush=function(){return void 0===l?s:h(R())},y}const L=1e3,z=6e4,C=36e5,P=24*C;function W(e){let t,n;const{start:a,cancel:f}=function(e){const t=o(null),n=()=>{r&&s(t.value)?cancelAnimationFrame(t.value):l(t.value)&&clearTimeout(t.value)};return i(()=>{n()}),{start:()=>{const n=t=>{e(t)};t.value=r?requestAnimationFrame(n):setTimeout(()=>n(Date.now()),1e3/30)},cancel:n}}(function(){e.millisecond?h():y()}),m=o(e.time),d=u(()=>{return{total:e=m.value,days:Math.floor(e/P),hours:Math.floor(e%P/C),minutes:Math.floor(e%C/z),seconds:Math.floor(e%z/L),milliseconds:Math.floor(e%L)};var e}),v=()=>{n=!1,f()},b=()=>Math.max(t-Date.now(),0),p=t=>{m.value=t,l(e.onChange)&&e.onChange(d.value),0===t&&(v(),l(e.onFinish)&&e.onFinish())},h=()=>{n&&(p(b()),m.value>0&&a())},y=()=>{if(n){const n=b();e=n,t=m.value,(Math.floor(e/1e3)!==Math.floor(t/1e3)||0===n)&&p(n),m.value>0&&a()}var e,t};return c(v),{start:()=>{n||(t=Date.now()+m.value,n=!0,a())},pause:v,reset:(t=e.time)=>{v(),m.value=t},current:d}}const $=f({__name:"index",props:{type:{},scene:{},email:{},mobile:{},second:{default:60},btnGetText:{default:"获取验证码"},btnIngText:{default:"正在发送中"},btnHairline:{type:Boolean,default:!0},btnPlain:{type:Boolean,default:!0},btnBlock:{type:Boolean,default:!0},btnRound:{type:Boolean,default:!0},btnSize:{default:"small"},btnType:{default:"primary"},customStyle:{}},setup(e){const t=e,n=m(),a=`countdown_v${t.scene}`,i=o(!1),{start:r,reset:s,current:l}=W({time:1e3*t.second}),c=parseInt(d.get(a)||0);if(c){const e=c+60-Math.floor(Date.now()/1e3);e>0&&(s(1e3*e),r())}const f=u(()=>"mobile"===t.type?!t.mobile:"email"===t.type&&!t.email),_=F(()=>{if("mobile"===t.type){if(!t.mobile)return n.show("请填写手机号码"),!1;i.value=!0,w.sendSms({scene:parseInt(String(t.scene)),mobile:t.mobile}).then(()=>{r();const e=Math.floor(Date.now()/1e3);d.set(a,String(e),60)}).catch(()=>{i.value=!1})}if("email"===t.type){if(!t.email)return n.show("请填写邮箱号"),!1;i.value=!0,w.sendEmail({scene:parseInt(String(t.scene)),email:t.email}).then(()=>{r();const e=Math.floor(Date.now()/1e3);d.set(a,String(e),60)}).catch(()=>{i.value=!1})}},500);return(e,t)=>{const n=M,a=v(b("wd-button"),E);return h(),p(a,{type:e.btnType,size:e.btnSize,plain:e.btnPlain,block:e.btnBlock,round:e.btnRound,hairline:e.btnHairline,disabled:y(i)||!!y(l).seconds||y(f),"custom-class":"!w-[186rpx]",style:T(e.customStyle),onClick:y(_)},{default:I(()=>[y(l).seconds?(h(),p(n,{key:1},{default:I(()=>[x(g(y(l).seconds)+"s后可重发 ",1)]),_:1})):(h(),p(n,{key:0},{default:I(()=>[x(g(y(i)?e.btnIngText:e.btnGetText),1)]),_:1}))]),_:1},8,["type","size","plain","block","round","hairline","disabled","style","onClick"])}}});var H=(e=>(e[e.LOGIN=101]="LOGIN",e[e.REGISTER=102]="REGISTER",e[e.FORGET_PWD=103]="FORGET_PWD",e[e.BIND_EMAIL=106]="BIND_EMAIL",e[e.BIND_MOBILE=105]="BIND_MOBILE",e))(H||{});export{H as N,$ as _};
