import{d as a,G as e,H as s,r as l,I as d,A as t,w as r,c as o,a as u,b as n,e as p,f as c,g as m,h as i,k as w,l as b,j as f,E as _,m as x,t as g,S as h,a$ as v,q as y}from"./index-4glTkX_N.js";import{_ as P}from"./wd-input.DYf8A7Ki.js";import{_ as k}from"./wd-button.Bm4eyLOH.js";import{_ as j}from"./wd-form.vue_vue_type_script_setup_true_lang.7ThkrgxC.js";import"./types.DQ6PHZfF.js";import"./index.mNFG9pMF.js";import"./index.D9GroqTO.js";import"./useTranslate.By_X5Fzm.js";const V=y(a({__name:"change_password",setup(a){const y=e(),V=s(),T=l(!1),z=d({oldPassword:"",newPassword:"",ackPassword:""}),B=l(V.userInfo.is_pwd?1:2),F=l(!1),I=l(!1),U=l(!1),A=l(""),C=l(""),E=l(""),q=t(()=>T.value||!!C.value||!!E.value||!z.newPassword||!z.ackPassword),G=async()=>{T.value=!0,await h.checkPwd(z.oldPassword).then(()=>{B.value=2}).catch(()=>{}).finally(()=>{setTimeout(()=>{T.value=!1},800)})},H=async()=>{T.value=!0,await h.changePwd({oldPassword:z.ackPassword,newPassword:z.newPassword}).then(()=>{y.show("修改成功"),setTimeout(()=>{v()},500)}).catch(()=>{}).finally(()=>{setTimeout(()=>{T.value=!1},800)})};return r(()=>z.newPassword,a=>{a?a.length<=1||a.length>20?C.value="新的密码长度不合法，因为6-20个字符":C.value="":C.value="新的密码不能为空"}),r(()=>z.ackPassword,a=>{a?a!==z.newPassword?E.value="两次密码不一致":E.value="":E.value="确认密码不能为空"}),(a,e)=>{const s=p(c("wd-input"),P),l=w,d=p(c("wd-button"),k),t=p(c("wd-form"),j),r=n("global-ku-root");return m(),o(r,null,{default:u(()=>[i(l,{class:"flex-1 p-6 pt-10 border-t border-br-thinned bg-page"},{default:u(()=>[1===f(B)?(m(),o(t,{key:0,model:f(z),class:"w-full"},{default:u(()=>[i(l,{class:_(["flex items-center p-3.5 rounded-xl bg-lighter border-2",f(A)?"border-danger":f(F)?"border-primary":"border-transparent"])},{default:u(()=>[i(s,{modelValue:f(z).oldPassword,"onUpdate:modelValue":e[0]||(e[0]=a=>f(z).oldPassword=a),disabled:f(T),"no-border":!0,prop:"password","show-password":"",placeholder:"请输入登录密码","custom-class":"flex-1 !bg-transparent",onFocus:e[1]||(e[1]=a=>F.value=!0),onBlur:e[2]||(e[2]=a=>F.value=!1)},null,8,["modelValue","disabled"])]),_:1},8,["class"]),i(l,{class:"pt-2 pl-3 text-sm text-danger h-4.5"},{default:u(()=>[f(A)?(m(),o(l,{key:0},{default:u(()=>[x(g(f(A)),1)]),_:1})):b("",!0)]),_:1}),i(l,{class:"mt-8 px-2 text-sm text-tx-placeholder"},{default:u(()=>[x(" 为了确保您是账户拥有者，现需要对您进行登录密码安全检验， 验证通过后方可进行修改。 ")]),_:1}),i(l,{class:"mt-6"},{default:u(()=>[i(d,{type:"primary",size:"large",block:!0,loading:f(T),disabled:f(T)||!f(z).oldPassword,onClick:G},{default:u(()=>[x(" 开始校验 ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"])):b("",!0),2===f(B)?(m(),o(t,{key:1,model:f(z),class:"w-full"},{default:u(()=>[i(l,null,{default:u(()=>[i(l,{class:"mb-1.5 text-tx-primary"},{default:u(()=>[x("输入新密码")]),_:1}),i(l,{class:_(["p-3.5 rounded-xl bg-lighter border-2",f(C)?"border-danger":f(I)?"border-primary":"border-transparent"])},{default:u(()=>[i(s,{modelValue:f(z).newPassword,"onUpdate:modelValue":e[3]||(e[3]=a=>f(z).newPassword=a),disabled:f(T),"no-border":!0,prop:"nickname",type:"text","show-password":"",placeholder:"请输入6-20位新密码","custom-class":"!bg-transparent",onFocus:e[4]||(e[4]=a=>I.value=!0),onBlur:e[5]||(e[5]=a=>I.value=!1)},null,8,["modelValue","disabled"])]),_:1},8,["class"]),i(l,{class:"pt-2 pl-3 text-sm text-danger h-4.5"},{default:u(()=>[f(C)?(m(),o(l,{key:0},{default:u(()=>[x(g(f(C)),1)]),_:1})):b("",!0)]),_:1})]),_:1}),i(l,{class:"mt-4"},{default:u(()=>[i(l,{class:"mb-1.5 text-tx-primary"},{default:u(()=>[x("确认新密码")]),_:1}),i(l,{class:_(["p-3.5 rounded-xl bg-lighter border-2",f(E)?"border-danger":f(U)?"border-primary":"border-transparent"])},{default:u(()=>[i(s,{modelValue:f(z).ackPassword,"onUpdate:modelValue":e[6]||(e[6]=a=>f(z).ackPassword=a),disabled:f(T),"no-border":!0,prop:"nickname",type:"text","show-password":"",placeholder:"请再次输入6-20位新密码","custom-class":"!bg-transparent",onFocus:e[7]||(e[7]=a=>U.value=!0),onBlur:e[8]||(e[8]=a=>U.value=!1)},null,8,["modelValue","disabled"])]),_:1},8,["class"]),i(l,{class:"pt-2 pl-3 text-sm text-danger h-4.5"},{default:u(()=>[f(E)?(m(),o(l,{key:0},{default:u(()=>[x(g(f(E)),1)]),_:1})):b("",!0)]),_:1})]),_:1}),i(l,{class:"mt-4 px-2 text-sm text-tx-placeholder"},{default:u(()=>[x(" 密码必须是6-20个英文字符、数字或符(除空格)， 且字母、数字和标点符号至少包含两种。 ")]),_:1}),i(l,{class:"mt-8"},{default:u(()=>[i(d,{type:"primary",size:"large",block:!0,loading:f(T),disabled:f(q),onClick:H},{default:u(()=>[x(" 确定 ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"])):b("",!0)]),_:1})]),_:1})}}}),[["__scopeId","data-v-7530fd53"]]);export{V as default};
