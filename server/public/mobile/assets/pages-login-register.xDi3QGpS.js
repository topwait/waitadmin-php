import{d as e,G as l,u as a,H as s,r as t,I as o,A as r,o as u,M as d,c,a as i,b as n,N as p,O as m,e as x,f as _,s as f,g,j as h,k as w,h as b,m as v,n as y,l as V,F as j,K as k,L as z,q as I}from"./index-4glTkX_N.js";import{_ as U}from"./index.vue_vue_type_script_setup_true_lang.BVfY-cXo.js";import{_ as C}from"./wd-input.DYf8A7Ki.js";import{_ as E,N}from"./notice.CpGJXdHh.js";import{_ as T}from"./wd-button.Bm4eyLOH.js";import{_ as A}from"./wd-form.vue_vue_type_script_setup_true_lang.7ThkrgxC.js";import"./types.DQ6PHZfF.js";import"./index.mNFG9pMF.js";import"./index.D9GroqTO.js";import{_ as L,l as F}from"./auth-protocol.vue_vue_type_script_setup_true_lang.bXm3GJ4o.js";import{_ as G}from"./close-channel.vue_vue_type_script_setup_true_lang.c3GB2ZN-.js";import"./useTranslate.By_X5Fzm.js";import"./wd-checkbox.Be-UkwSr.js";const H=I(e({__name:"register",setup(e){const I=l(),H=a(),M=s(),O=t(!1),R=t(!0),W=t(!1),X=t(!1),q=o({account:"",password:"",confirm_pwd:"",mobile:"",code:""}),B=r(()=>{var e,l,a,s,t,o,r,u,d;const c=H.getLoginConfig;switch(p.fetchClient()){case m.H5:return R.value=null==(e=c.h5)?void 0:e.is_agreement,O.value=!(null==(a=null==(l=c.h5)?void 0:l.usable_register)?void 0:a.includes("account")),c.h5||{};case m.MP_WEIXIN:case m.OA_WEIXIN:return R.value=null==(s=c.wx)?void 0:s.is_agreement,O.value=!(null==(o=null==(t=c.wx)?void 0:t.usable_register)?void 0:o.includes("account")),c.wx||{};default:return R.value=null==(r=c.other)?void 0:r.is_agreement,O.value=!(null==(d=null==(u=c.other)?void 0:u.usable_register)?void 0:d.includes("account")),c.other||{}}}),K=async()=>{if(q.code)return I.show("请输入登录账号"),!1;if(!q.password)return I.show("请输入登录密码"),!1;if(q.password!==q.confirm_pwd)return I.show("两次输入密码不一致"),!1;if(R.value&&!W.value)return I.show("请阅读《服务协议》与《隐私协议》"),!1;if(B.value.force_mobile){if(!q.mobile)return I.show("请填写手机号码"),!1;if(!q.mobile)return I.show("请填写验证码"),!1}X.value=!0,await F.register({account:q.account,password:q.password,mobile:q.mobile,code:q.code}).then(async e=>{I.show("注册成功"),await M.login(e.token),setTimeout(()=>{d({url:"/pages/user/index"}),X.value=!1},1e3)}).finally(()=>{setTimeout(()=>{X.value=!1},1500)})};return u(()=>{M.isLogin&&d({url:"/pages/index/index"})}),(e,l)=>{const a=w,s=x(_("w-widget-bar"),U),t=x(_("wd-icon"),f),o=x(_("wd-input"),C),r=x(_("w-verify-code"),E),u=x(_("wd-button"),T),d=z,p=x(_("wd-form"),A),m=n("global-ku-root");return g(),c(m,null,{default:i(()=>[h(O)?(g(),c(a,{key:0,class:"flex-1 flex items-center justify-center"},{default:i(()=>[b(G,{message:"注册渠道尚未开放"})]),_:1})):(g(),c(a,{key:1,class:"register flex-1 flex flex-col bg-page"},{default:i(()=>[b(s),b(a,{class:"text-6xl text-tx-primary font-bold px-10 mt-10"},{default:i(()=>[v(" 注册账号 ")]),_:1}),b(a,{class:"text-sm text-tx-placeholder px-10 mt-2"},{default:i(()=>[v(" 别看了，就差你了！快注册！ ")]),_:1}),b(a,{class:"w-full px-10 mt-10"},{default:i(()=>[b(p,{ref:"form",model:h(q)},{default:i(()=>[b(a,{class:"flex items-center py-1.5 px-4 rounded-[60rpx] bg-lighter"},{default:i(()=>[b(t,{name:"user",size:"38rpx"}),b(a,{class:"w-[1px] h-[40rpx] mx-2.5 bg-light"}),b(o,{modelValue:h(q).account,"onUpdate:modelValue":l[0]||(l[0]=e=>h(q).account=e),maxlength:20,prop:"account",clearable:"","clear-trigger":"focus",placeholder:"请输入账号","placeholder-class":"!text-tx-placeholder"},null,8,["modelValue"])]),_:1}),b(a,{class:"flex items-center py-1.5 px-4 mt-4 rounded-[60rpx] bg-lighter"},{default:i(()=>[b(t,{name:"lock-on",size:"38rpx"}),b(a,{class:"w-[1px] h-[40rpx] mx-2.5 bg-light"}),b(o,{modelValue:h(q).password,"onUpdate:modelValue":l[1]||(l[1]=e=>h(q).password=e),maxlength:50,prop:"password",clearable:"","show-password":"","clear-trigger":"focus",placeholder:"请输入密码","placeholder-class":"!text-tx-placeholder"},null,8,["modelValue"])]),_:1}),b(a,{class:"flex items-center py-1.5 px-4 mt-4 rounded-[60rpx] bg-lighter"},{default:i(()=>[b(t,{name:"lock-on",size:"38rpx"}),b(a,{class:"w-[1px] h-[40rpx] mx-2.5 bg-light"}),b(o,{modelValue:h(q).confirm_pwd,"onUpdate:modelValue":l[2]||(l[2]=e=>h(q).confirm_pwd=e),maxlength:50,prop:"password",clearable:"","show-password":"","clear-trigger":"focus",placeholder:"请确认密码","placeholder-class":"!text-tx-placeholder"},null,8,["modelValue"])]),_:1}),h(B).force_mobile?(g(),y(j,{key:0},[b(a,{class:"flex items-center py-1.5 px-4 mt-4 rounded-[60rpx] bg-lighter"},{default:i(()=>[b(t,{name:"mobile",size:"38rpx"}),b(a,{class:"w-[1px] h-[40rpx] mx-2.5 bg-light"}),b(o,{modelValue:h(q).mobile,"onUpdate:modelValue":l[3]||(l[3]=e=>h(q).mobile=e),maxlength:11,prop:"mobile",clearable:"","clear-trigger":"focus",placeholder:"请输入手机号","placeholder-class":"!text-tx-placeholder"},null,8,["modelValue"])]),_:1}),b(a,{class:"flex items-center py-1.5 px-4 mt-4 rounded-[60rpx] bg-lighter"},{default:i(()=>[b(t,{name:"secured",size:"38rpx"}),b(a,{class:"w-[1px] h-[40rpx] mx-2.5 bg-light"}),b(o,{modelValue:h(q).code,"onUpdate:modelValue":l[4]||(l[4]=e=>h(q).code=e),maxlength:15,prop:"code",type:"number",placeholder:"请输入验证码","placeholder-class":"!text-tx-placeholder"},null,8,["modelValue"]),b(r,{type:"mobile",mobile:h(q).mobile,scene:h(N).REGISTER},null,8,["mobile","scene"])]),_:1})],64)):V("",!0),h(B).is_agreement?(g(),c(a,{key:1,class:"mt-4 ml-2"},{default:i(()=>[b(L,{modelValue:h(W),"onUpdate:modelValue":l[5]||(l[5]=e=>k(W)?W.value=e:null)},null,8,["modelValue"])]),_:1})):V("",!0),b(a,{class:"mt-6"},{default:i(()=>[b(u,{type:"primary",size:"large",disabled:h(X),loading:h(X),block:"",onClick:K},{default:i(()=>[v(" 注册 ")]),_:1},8,["disabled","loading"])]),_:1}),b(a,{class:"text-center text-sm mt-4"},{default:i(()=>[b(d,{class:"text-tx-placeholder"},{default:i(()=>[v("已有账号?")]),_:1}),b(d,{class:"ml-1 text-primary",onClick:l[6]||(l[6]=l=>e.$go("/pages/login/index"))},{default:i(()=>[v(" 立即登录 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}))]),_:1})}}}),[["__scopeId","data-v-92dcdaad"]]);export{H as default};
