import{z as e,y as a,X as l,Y as t,x as u,d as s,r as o,$ as i,av as n,Z as c,w as r,B as v,C as d,a2 as m,c as p,l as h,g,a as f,h as w,k as _,E as x,G as y,a5 as b,aY as k,v as S,m as $,t as M,j as T,aZ as j,a_ as C,a$ as I,s as N,H,I as Y,V as R,o as V,b as W,e as X,f as q,K as z,_ as P,aa as B,aN as U,i as F,U as A}from"./index-CbP45Wwt.js";import{_ as E}from"./index.Btqrcc5g.js";import{_ as G}from"./wd-message-box.CUDv5hjY.js";import{_ as O,a as K}from"./wd-cell-group.OB_X9OU7.js";import{_ as L}from"./wd-picker.Su60wahG.js";import{_ as Z}from"./wd-button.VA8QVjvr.js";import{u as D}from"./useTranslate.BahM4N0k.js";import"./types.DuL_ynPZ.js";import"./index.CDE1r9Ff.js";import"./index.D9GroqTO.js";import"./wd-popup.C0DdTWGY.js";import"./wd-input.BHaKXBII.js";const J=N(s({name:"wd-img-cropper",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...e,modelValue:u(!1),cancelButtonText:String,confirmButtonText:String,disabledRotate:u(!1),fileType:a("png"),quality:l(1),exportScale:l(2),imgSrc:a(""),imgWidth:t(""),imgHeight:t(""),maxScale:l(3),aspectRatio:a("1:1")},emits:["imgloaded","imgloaderror","cancel","confirm","update:modelValue"],setup(e,{expose:a,emit:l}){const t=o(`cropper${i()}`);let u=null,s=null,N=!0,H=null,Y=null;const R=.85,V=e,W=l,{translate:X}=D("img-cropper"),q=o(0),z=o(!1),P=o(0),B=o(0),U=o(0),F=o(0),A=o(20),E=o(0),G=o(0),O=o(""),K=o(""),L=o(2),J=o(1),Q=o(n().windowWidth/2),ee=o(n().windowHeight/2*R),ae=o(null),le=o(n()),te=o(!0),ue=o([{x:"",y:""},{x:"",y:""}]),se=o(""),oe=o(null),{proxy:ie}=c();r(()=>V.modelValue,e=>{if(e){H=V.imgWidth,Y=V.imgHeight,le.value=n();const[e,a]=V.aspectRatio.split(":").map(Number),l=le.value.windowWidth-2*A.value,u=l*a/e;U.value=l,F.value=u,G.value=(le.value.windowHeight*R-u)/2,E.value=A.value,L.value=V.exportScale,K.value=u,O.value=l,function(){if(H&&"string"==typeof H&&-1!==H.indexOf("%")){const e=H.replace("%","");H=le.value.windowWidth/100*Number(e),P.value=H}else H&&"number"==typeof H&&(P.value=H);if(Y&&"string"==typeof Y&&-1!==Y.indexOf("%")){const e=V.imgHeight.replace("%","");Y=le.value.windowHeight/100*Number(e),P.value=Y}else Y&&"number"==typeof Y&&(P.value=Number(H))}(),oe.value||(oe.value=I(t.value,ie)),V.imgSrc&&me()}else de()},{deep:!0,immediate:!0}),r(()=>V.imgSrc,e=>{e&&me()},{deep:!0,immediate:!0}),r(()=>q.value,e=>{e%90&&(q.value=90*Math.round(e/90))},{deep:!0,immediate:!0}),r(()=>z.value,e=>{u&&clearTimeout(u),e&&(u=setTimeout(()=>{re(!1),clearTimeout(u)},300))},{deep:!0,immediate:!0});const ne=v(()=>d({position:"absolute",right:0,width:"56px","border-radius":"16px","font-size":"16px"})),ce=v(()=>{const e={width:P.value?m(P.value):"auto",height:B.value?m(B.value):"auto",transform:`translate(${m(Q.value-P.value/2)}, ${m(ee.value-B.value/2)}) scale(${J.value}) rotate(${q.value}deg)`,"transition-duration":(z.value?.4:0)+"s"};return d(e)});function re(e){z.value="boolean"==typeof e?e:e.value}function ve(e){if(!e||V.disabledRotate)return;re(!0),q.value=e;let a=P.value,l=B.value;e/90%2&&(a=B.value,l=P.value);const t=U.value/a,u=F.value/l;J.value=Math.max(t,u),pe()}function de(){const{windowHeight:e,windowWidth:a}=n();J.value=1,q.value=0,Q.value=a/2,ee.value=e/2*R}function me(){V.imgSrc&&C({src:V.imgSrc,success:e=>{ae.value=e,function(){let e=P.value,a=B.value;if(Y||H)Y&&!H?(a=Number(Y),e=ae.value.width/ae.value.height*a):(!Y&&H||Y&&H)&&(e=Number(H),a=ae.value.height/ae.value.width*e);else{const l=ae.value.width/ae.value.height;l>U.value/F.value?(a=F.value,e=a*l):(e=U.value,a=e/l)}const l=U.value/e,t=F.value/a,u=Math.max(l,t);P.value=e,B.value=a,J.value=u}(),de()},fail:()=>{}})}function pe(e){const a=e||J.value;let l=Q.value,t=ee.value,u=P.value,s=B.value;q.value/90%2&&(u=B.value,s=P.value),l=u*a/2+E.value>=l?l:u*J.value/2+E.value,l=E.value+U.value-u*a/2<=l?l:E.value+U.value-u*a/2,t=s*a/2+G.value>=t?t:s*a/2+G.value,t=G.value+F.value-s*a/2<=t?t:G.value+F.value-s*a/2,J.value=a,ee.value=t,Q.value=l}function he(e){if(te.value=!1,1===e.touches.length)ue.value[0]={x:e.touches[0].clientX-Q.value,y:e.touches[0].clientY-ee.value};else{const a=Math.abs(e.touches[1].clientX-e.touches[0].clientX),l=Math.abs(e.touches[1].clientY-e.touches[0].clientY);se.value=Math.sqrt(Math.pow(a,2)+Math.pow(l,2))}}function ge(e){if(!te.value&&N)if("android"===le.value.platform?(s&&clearTimeout(s),s=setTimeout(()=>{N=!0},25)):!N&&(N=!0),1===e.touches.length){const{x:a,y:l}=ue.value[0],t=e.touches[0].clientX-Number(a),u=e.touches[0].clientY-Number(l);Q.value=t,ee.value=u,pe()}else{const a=Math.abs(e.touches[1].clientX-e.touches[0].clientX),l=Math.abs(e.touches[1].clientY-e.touches[0].clientY),t=Math.sqrt(Math.pow(a,2)+Math.pow(l,2)),u=J.value*(t/Number(se.value));J.value=Math.min(u,V.maxScale),function(){let e=P.value,a=B.value,l=J.value;q.value/90%2&&(e=B.value,a=P.value),e*l<U.value&&(l=U.value/e),a*l<F.value&&(l=F.value/a),pe(l)}(),se.value=Math.sqrt(Math.pow(a,2)+Math.pow(l,2))}}function fe(){te.value=!0}function we(e){W("imgloaded",e)}function _e(e){W("imgloaderror",e)}function xe(){ve(q.value-90)}function ye(){W("cancel"),W("update:modelValue",!1)}function be(){!function(){if(!V.imgSrc)return;const e=()=>{const e=P.value*J.value*V.exportScale,a=B.value*J.value*V.exportScale,l=Q.value-E.value,u=ee.value-G.value;oe.value.translate(l*V.exportScale,u*V.exportScale),V.disabledRotate||oe.value.rotate(q.value*Math.PI/180),oe.value.drawImage(V.imgSrc,-e/2,-a/2,e,a),oe.value.restore(),oe.value.draw(!1,()=>{!function(){const{fileType:e,quality:a,exportScale:l}=V;j({width:U.value*l,height:Math.round(F.value*l),destWidth:U.value*l,destHeight:Math.round(F.value*l),fileType:e,quality:a,canvasId:t.value,success:e=>{const a={tempFilePath:e.tempFilePath,width:U.value*l,height:F.value*l};W("confirm",a)},complete:()=>{W("update:modelValue",!1)}},ie)}()})};K.value=F.value,O.value=U.value,e()}()}function ke(){}return a({revertIsAnimation:re,setRoate:ve,resetImg:de}),(e,a)=>{const l=_,u=b,s=k;return e.modelValue?(g(),p(l,{key:0,class:y(`wd-img-cropper ${e.customClass}`),style:x(e.customStyle),onTouchmove:ke},{default:f(()=>[w(l,{class:"wd-img-cropper__wrapper"},{default:f(()=>[w(l,{class:"wd-img-cropper__cut"},{default:f(()=>[w(l,{class:y("wd-img-cropper__cut--top "+(te.value?"":"is-hightlight")),style:x(`height: ${G.value}px;`)},null,8,["class","style"]),w(l,{class:"wd-img-cropper__cut--middle",style:x(`height: ${F.value}px;`)},{default:f(()=>[w(l,{class:y("wd-img-cropper__cut--left "+(te.value?"":"is-hightlight")),style:x(`width: ${E.value}px; height: ${F.value}px;`)},null,8,["class","style"]),w(l,{class:"wd-img-cropper__cut--body",style:x(`width: ${U.value}px; height: ${F.value}px;`)},{default:f(()=>[w(l,{class:"is-gridlines-x"}),w(l,{class:"is-gridlines-y"}),w(l,{class:"is-left-top"}),w(l,{class:"is-left-bottom"}),w(l,{class:"is-right-top"}),w(l,{class:"is-right-bottom"})]),_:1},8,["style"]),w(l,{class:y("wd-img-cropper__cut--right "+(te.value?"":"is-hightlight"))},null,8,["class"])]),_:1},8,["style"]),w(l,{class:y("wd-img-cropper__cut--bottom "+(te.value?"":"is-hightlight"))},null,8,["class"])]),_:1}),w(u,{prop:z.value,"change:prop":"",class:"wd-img-cropper__img",src:e.imgSrc,style:x(ce.value),"lazy-load":!1,onTouchstart:he,onTouchmove:ge,onTouchend:fe,onError:_e,onLoad:we},null,8,["prop","change:prop","src","style"])]),_:1}),w(s,{"canvas-id":t.value,id:t.value,class:"wd-img-cropper__canvas","disable-scroll":!0,style:x(`width: ${Number(O.value)*L.value}px; height: ${Number(K.value)*L.value}px;`)},null,8,["canvas-id","id","style"]),w(l,{class:"wd-img-cropper__footer"},{default:f(()=>[e.disabledRotate?h("",!0):(g(),p(S,{key:0,"custom-class":"wd-img-cropper__rotate",name:"rotate",onClick:xe})),w(l,{class:"wd-img-cropper__footer--button"},{default:f(()=>[w(l,{class:"is-cancel",onClick:ye},{default:f(()=>[$(M(e.cancelButtonText||T(X)("cancel")),1)]),_:1}),w(Z,{size:"small","custom-style":ne.value,onClick:be},{default:f(()=>[$(M(e.confirmButtonText||T(X)("confirm")),1)]),_:1},8,["custom-style"])]),_:1})]),_:1})]),_:1},8,["class","style"])):h("",!0)}}}),[["__scopeId","data-v-e2d7a4cc"]]),Q=N(s({__name:"intro",setup(e){const a=H(),l=Y(),t=o(!0),{userInfo:u}=R(l),s=o(!1),i=o(""),n=["未知","男","女"],c=()=>{U({count:1,success:e=>{i.value=e.tempFilePaths[0]||"",s.value=!0}})},r=async e=>{var t;let u=e.tempFilePath||"";(null==(t=e.detail)?void 0:t.avatarUrl)&&(u=e.detail.avatarUrl);const o=await F.upload("picture","permanent",{filePath:u});i.value="",s.value=!1,a.loading({msg:"上传中...",zIndex:9999,cover:!0}),await A.edit({scene:"avatar",value:o.url}),await l.getUser(),a.close()},v=async({value:e})=>{const a=n.indexOf(e);await A.edit({scene:"gender",value:String(a)}),await l.getUser()};return V(()=>{t.value=!1}),(e,a)=>{const l=X(q("w-loading"),E),o=X(q("wd-toast"),z),d=X(q("wd-message-box"),G),m=X(q("wd-img"),P),h=_,x=B,y=X(q("wd-cell"),O),b=X(q("wd-icon"),S),k=X(q("wd-picker"),L),j=X(q("wd-cell-group"),K),C=X(q("wd-img-cropper"),J),I=W("global-ku-root");return g(),p(I,null,{default:f(()=>[w(l,{show:T(t),delay:500},null,8,["show"]),w(h,null,{default:f(()=>[w(o),w(d),w(h,{class:"mt-3"},{default:f(()=>[w(j,{border:""},{default:f(()=>[w(y,null,{default:f(()=>[w(x,{style:{height:"100%","background-color":"unset"},"open-type":"chooseAvatar",onChooseavatar:r,onClick:c},{default:f(()=>[w(h,{class:"flex flex-col items-center justify-center"},{default:f(()=>[w(h,{class:"w-[110rpx] h-[110rpx] rounded-full bg-light"},{default:f(()=>[w(m,{src:T(u).avatar,width:"100%",height:"100%",round:""},null,8,["src"])]),_:1}),w(h,{class:"text-xs text-tx-placeholder mt-2"},{default:f(()=>[$("点击修改头像")]),_:1})]),_:1})]),_:1})]),_:1}),w(y,{title:"ID"},{default:f(()=>[$(M(T(u).sn)+" ",1),w(b,{name:"lock-on"})]),_:1}),w(y,{title:"账号",value:T(u).account,"is-link":!0,onClick:a[0]||(a[0]=a=>e.$go("/bundle/pages/user/change_account"))},null,8,["value"]),w(y,{title:"昵称",value:T(u).nickname,"is-link":!0,onClick:a[1]||(a[1]=a=>e.$go("/bundle/pages/user/change_nickname"))},null,8,["value"]),w(k,{"v-model":T(u).gender,columns:n,"use-default-slot":"",onConfirm:v},{default:f(()=>[w(y,{title:"性别","is-link":"",value:T(u).gender},null,8,["value"])]),_:1},8,["v-model"])]),_:1})]),_:1}),w(h,{class:"my-3"},{default:f(()=>[w(j,{border:""},{default:f(()=>[w(y,{title:"密保手机",value:T(u).mobile||"点击修改","is-link":!0,onClick:a[2]||(a[2]=a=>e.$go("/pages/user/adjust_mobile"))},null,8,["value"]),w(y,{title:"电子邮箱","is-link":!0,value:T(u).email||"点击修改",onClick:a[3]||(a[3]=a=>e.$go("/pages/user/adjust_email"))},null,8,["value"]),w(y,{title:"登录密码","is-link":!0,value:"点击修改",onClick:a[4]||(a[4]=a=>e.$go("/pages/user/change_password"))})]),_:1})]),_:1}),w(C,{"model-value":T(s),"img-src":T(i),onConfirm:r},null,8,["model-value","img-src"])]),_:1})]),_:1})}}}),[["__scopeId","data-v-d1e704b3"]]);export{Q as default};
