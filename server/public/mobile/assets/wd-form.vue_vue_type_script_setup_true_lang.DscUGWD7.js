import{d as s,H as e,an as a,J as o,w as r,c as t,g as p,k as n,E as l,G as c,a as i,D as m,l as f,K as u,bi as d,a6 as g,bs as h,bt as y,ag as b,bm as w}from"./index-CbP45Wwt.js";import{f as k,F as x}from"./wd-input.BHaKXBII.js";const E=s({name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:k,setup(s,{expose:k}){const{show:E}=e("wd-form-toast"),O=s,{children:j,linkChildren:v}=a(x);let C=o({});function T(s){s?C[s]="":Object.keys(C).forEach(s=>{C[s]=""})}return v({props:O,errorMessages:C}),r(()=>O.model,()=>{O.resetOnChange&&T()},{immediate:!0,deep:!0}),k({validate:async function(s){const e=[];let a=!0;const o=[],r=function(){const s=w(O.rules),e=j.map(s=>s.prop);return Object.keys(s).forEach(a=>{e.includes(a)||delete s[a]}),j.forEach(e=>{g(e.prop)&&g(e.rules)&&e.rules.length&&(s[e.prop]?s[e.prop]=[...s[e.prop],...e.rules]:s[e.prop]=e.rules)}),s}(),t=d(s)?s:g(s)?[s]:[],p=t.length>0?t.reduce((s,e)=>(r[e]&&(s[e]=r[e]),s),{}):r;for(const n in p){const s=p[n],r=h(O.model,n);if(s&&s.length>0)for(const t of s){if(t.required&&(!g(r)||""===r)){e.push({prop:n,message:t.message}),a=!1;break}if(t.pattern&&!t.pattern.test(r)){e.push({prop:n,message:t.message}),a=!1;break}const{validator:s,...p}=t;if(s){const l=s(r,p);y(l)?o.push(l.then(s=>{"string"==typeof s?(e.push({prop:n,message:s}),a=!1):"boolean"!=typeof s||s||(e.push({prop:n,message:t.message}),a=!1)}).catch(s=>{const o=g(s)?b(s)?s:s.message||t.message:t.message;e.push({prop:n,message:o}),a=!1})):l||(e.push({prop:n,message:t.message}),a=!1)}}}return await Promise.all(o),function(s){const e=j.map(s=>s.prop).filter(Boolean),a=s.filter(s=>s.message&&e.includes(s.prop));a.length&&(a.sort((s,a)=>e.indexOf(s.prop)-e.indexOf(a.prop)),"toast"===O.errorType?E(a[0].message):"message"===O.errorType&&a.forEach(s=>{C[s.prop]=s.message}))}(e),a&&(t.length?t.forEach(T):T()),{valid:a,errors:e}},reset:function(){T()}}),(s,e)=>{const a=n;return p(),t(a,{class:c(`wd-form ${s.customClass}`),style:l(s.customStyle)},{default:i(()=>[m(s.$slots,"default"),"toast"===O.errorType?(p(),t(u,{key:0,selector:"wd-form-toast"})):f("",!0)]),_:3},8,["class","style"])}}});export{E as _};
